<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Firebase 모듈로 구성한 멀티플레이어 우노 게임</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }
    #game-board {
      display: flex;
      flex-wrap: wrap;
      max-width: 600px;
      margin: 20px auto;
      justify-content: center;
    }
    .card {
      width: 80px;
      height: 120px;
      margin: 10px;
      border: 2px solid #333;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
      cursor: pointer;
      user-select: none;
      transition: transform 0.2s;
    }
    .card:hover {
      transform: scale(1.05);
    }
    .red { background-color: red; }
    .blue { background-color: blue; }
    .yellow { background-color: yellow; color: black; }
    .green { background-color: green; }
    .black { background-color: black; }
    /* 로그 영역 스타일 */
    #log {
      max-width: 600px;
      margin: 20px auto;
      text-align: left;
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      height: 150px;
      overflow-y: auto;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>멀티플레이어 우노 게임</h1>
  <div id="game-board"></div>
  <h3>카드 플레이 로그</h3>
  <div id="log"></div>

  <!-- Firebase 모듈을 사용 (type="module") -->
  <script type="module">
    // Firebase SDK 모듈 가져오기
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-analytics.js";
    import { getDatabase, ref, push, set, onChildAdded } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";

    // Firebase 구성 (Firebase 콘솔에서 제공하는 설정 정보 사용)
    const firebaseConfig = {
      apiKey: "AIzaSyCVg8joZy6HLOLbiNUCVD9yMgOb3NDbll8",
      authDomain: "game-uno-1.firebaseapp.com",
      projectId: "game-uno-1",
      storageBucket: "game-uno-1.firebasestorage.app",
      messagingSenderId: "127524275045",
      appId: "1:127524275045:web:21cd550e8c82ea8334978c",
      measurementId: "G-NSRV1KM0W1"
    };

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);

    // HTML 요소 가져오기
    const gameBoard = document.getElementById("game-board");
    const logDiv = document.getElementById("log");

    // 로그 추가 함수 (새로운 카드 이벤트를 로그 영역에 표시)
    function appendLog(message) {
      const p = document.createElement("p");
      p.textContent = message;
      logDiv.appendChild(p);
      logDiv.scrollTop = logDiv.scrollHeight; // 스크롤을 항상 최신 로그로 이동
    }

    // 카드 요소 생성 함수
    function createCard(color, label) {
      const card = document.createElement("div");
      card.classList.add("card", color);
      card.textContent = label;
      card.addEventListener("click", () => {
        // 카드 클릭 시 데이터 생성
        const cardData = { color, label, timestamp: Date.now() };
        // Realtime Database의 'cardPlayed' 경로에 새로운 카드 플레이 기록 추가
        const cardPlayedRef = ref(database, "cardPlayed");
        const newCardRef = push(cardPlayedRef);
        set(newCardRef, cardData)
          .then(() => {
            console.log("카드 플레이 기록 성공:", cardData);
            appendLog(`내가 플레이: ${label} (${color})`);
          })
          .catch((error) => {
            console.error("카드 플레이 기록 에러:", error);
          });
      });
      return card;
    }

    // 기본 카드 구성: 빨강, 파랑, 노랑, 초록 카드
    const colors = ["red", "blue", "yellow", "green"];
    colors.forEach((color) => {
      // 각 색상의 카드(예제에서는 색상 이름을 대문자로 표시)
      const card = createCard(color, color.toUpperCase());
      gameBoard.appendChild(card);
    });

    // 와일드 카드 (색상 변경 카드, 검정색)
    const wildCard = createCard("black", "Wild");
    gameBoard.appendChild(wildCard);

    // 다른 사용자의 카드 플레이 이벤트 수신
    const cardPlayedRef = ref(database, "cardPlayed");
    onChildAdded(cardPlayedRef, (snapshot) => {
      const data = snapshot.val();
      console.log("새로운 카드 플레이:", data);
      // 자신이 보낸 이벤트와 중복되지 않도록 로직 추가 가능 (현재는 단순 로그 출력)
      appendLog(`플레이됨: ${data.label} (${data.color})`);
    });
  </script>
</body>
</html>
